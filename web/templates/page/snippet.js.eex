!function(){"use strict";function t(){}function n(t,e){var o,r,i,a=[];for(o in t)t.hasOwnProperty(o)&&(r=e?e+"["+o+"]":o,i=t[o],a.push("object"==typeof i?n(i,r):encodeURIComponent(r)+"="+encodeURIComponent(i)));return a.join("&")}function e(t,e){var o=n(e);return""===o?t:t+"?"+o}function o(n){var o=n.method,r=n.url,i=n.params,a=n.body,u=n.success||t,c=n.fail||t,s=new XMLHttpRequest;s.open(o,e(r,i),!0),s.onreadystatechange=function(){if(4===this.readyState){var t=JSON.parse(this.responseText);this.status>=200&&this.status<400?u(t):c(t)}},s.setRequestHeader("Content-Type","application/json"),s.send(a?JSON.stringify(a):void 0),s=null}function r(t,n,e){var o,r;null===e?o="":(r=new Date,r.setTime(r.getTime()+60*e*1e3),o="expires="+r.toUTCString()),document.cookie=t+"="+n+"; "+o+"; path=/"}function i(t){var n,e,o=t+"=",r=document.cookie.split("; ");for(e=r.length-1;e>=0;e--)if(n=r[e],0===n.indexOf(o))return n.substring(o.length,n.length);return!1}function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}function u(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}function c(t){for(var n,e=t.length,o={};e--;)n=t[e],o[n.name]=n.value;return o}function s(t){return function(n){if(n.clientX){var e=n.target;console.log({url:"localhost:8080/click",method:"POST",body:{cid:t,nfa_id:l,url:location.href,bookmarklet:!1,payload:{target:e.outerHTML,attrs:c(e.attributes)}}}),o({url:"http://localhost:4000/click",method:"POST",body:{cid:t,nfa_id:l,url:location.href,bookmarklet:!1,payload:{target:e.outerHTML,attrs:c(e.attributes)}}})}}}var l;window.NFA={init:function(t){var n=i("nfa")||u();r("nfa",n),l=t,document.onclick=s(n)}}}();window.NFA.init("<%= @nfa_id %>");